services:
    web:
        build:
            context: .
            dockerfile: ./Dockerfile
        entrypoint: ["/app/infrastructure/scripts/entrypoint.sh"]
        restart: always
        container_name: ca-server
        ports:
            - "8000:8000"
        volumes:
            - ./storage:/app/storage
        networks:
            - app-network
        depends_on:
            - redis

    redis:
        image: redis:7.2.4-alpine
        container_name: ca-redis
        restart: unless-stopped
        volumes:
            - ~/current-affairs/redis_data:/data
            - ./infrastructure/configuration/redis/redis-production.conf:/usr/local/etc/redis/redis.conf
        entrypoint: ["redis-server", "/usr/local/etc/redis/redis.conf"]
        networks:
            - app-network
networks:
    app-network:
        driver: bridge
